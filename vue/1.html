<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./vue.js"></script>
    <script src="./1.json"></script>
    <style>
        .add {
            position: fixed;
            background-color: rgba(0, 0, 0, .5);
            top: 50%;
            width: 100%;
            height: 100%;
        }

        * {
            margin: 0;
            padding: 0;
            list-style: none;
            text-decoration: none;
            box-sizing: border-box;
        }

        table {
            width: 700px;
        }

        th,
        td {
            border: 1px solid black;
            text-align: center;
        }

        .change {

            display: flex;
            justify-content: space-between;
        }

        .change button {
            width: 20px;
        }

        .proTime {

            width: 150px;

        }
    </style>
    

</head>

<body>
    <div class="box">
        <div class="top"> <input type="checkbox" v-model="checkAll" @change="change"><label for="">全选</label>
            <button @click="alter">反选</button>
            <button @click="noSelect">全不选</button>
            <button @click="delGroup">批量删除</button>
            <button @click='reset'>清空购物车</button>
            <button @click="show=true">添加</button>
            <button @click='sort'>倒序</button>
            <input type="text" placeholder="请输入名称">
        </div>
        <table>
            <thead>
                <tr>
                    <th>选项</th>
                    <th>名称</th>
                    <th>产地</th>
                    <th>数量</th>
                    <th>生产时间</th>
                    <th>单价</th>
                    <th>小计</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>

                <tr v-for="item in res" :key="item.id">
                    <td><input type="checkbox" v-model="item.checked"></td>
                    <td>{{item.gname}}</td>
                    <td>{{item.address}}</td>
                    <td class="change"><button
                            @click="item.num>0?item.num--:item.num=0">-</button><span>{{item.num}}</span><button
                            @click="item.num++">+</button></td>
                    <td class="proTime">{{item.regDate}}</td>
                    <td>￥{{item.price}}</td>
                    <td>￥{{item.price*item.num}}</td>
                    <td><button @click="del(item.gname)">删除</button><button>修改</button></td>
                </tr>
            </tbody>
            <!-- 总价格 -->
            <tfoot>
                <td colspan="8">总价：￥{{total}}</td>
            </tfoot>
        </table>
        <div class="add" v-show="show" @click.self="show=false">
            <div class="name"><label for="">名称</label><input type="text" v-model="dialogForm.name" placeholder="请输入名称">
            </div>
            <div class="address"> <label for="">产地</label><input type="text" v-model="dialogForm.address"
                    placeholder="请输入产地"></div>
            <div class="price"><label for="">价格</label><input type="text" v-model="dialogForm.price"
                    placeholder="请输入价格">
            </div>
            <button @click="confirm">确认添加</button>
        </div>
    </div>

    <script>

        const vm = new Vue({
            el: '.box',

            data: {
                dialogForm: {
                    name: '',
                    address: '',
                    price: 0
                },
                flag: true,
                res: [
                    {
                        id: 1,
                        gname: "云南白药",
                        address: "云南",
                        num: 3,
                        regDate: "1371120093221",
                        price: 36,
                        state: "发货",
                        checked: true
                    },
                    {
                        id: 2,
                        gname: "999感冒灵",
                        address: "北京",
                        num: 2,
                        regDate: "1371399948599",
                        price: 22,
                        state: "发货",
                        checked: true
                    },
                    {
                        id: 3,
                        gname: "感康",
                        address: "河北",
                        num: 5,
                        regDate: "1371394846499",
                        price: 18,
                        state: "已发货",
                        checked: false
                    },
                    {
                        id: 4,
                        gname: "板蓝根",
                        address: "河南",
                        num: 5,
                        regDate: "1371394846499",
                        price: 19,
                        state: "已发货",
                        checked: false
                    },
                    {
                        id: 5,
                        gname: "创可贴",
                        address: "吉林",
                        num: 15,
                        regDate: "1371394846499",
                        price: 7,
                        state: "已发货",
                        checked: false
                    }
                ],
                checkAll: false,
                show: false
            },
            methods: {
                confirm() {
                    this.res.push({
                        id:Date.now(),

                    })
                    console.log(this.dialogForm)
                },
                noSelect() {
                    this.res.forEach(item => {
                        item.checked = false
                    })
                },
                change() {
                    this.res.forEach(item => {
                        item.checked = this.checkAll
                    })
                },
                delGroup() {
                    this.res = this.res.filter(item => !item.checked)
                },
                add() {
                    this.num1++
                },
                reduce() {
                    this.num1 > 0 ? this.num1-- : 0
                },
                sort(a, b) {
                    this.flag = this.flag === true ? false : true
                    this.res.sort((a, b) => {
                        return this.flag === true ? a.price - b.price : b.price - a.price
                    })
                },
                del(name) {
                    for (let i = 0; i < this.res.length; i++) {
                        if (this.res[i].gname == name) {
                            this.res.splice(i, 1)
                        }
                    }
                },
                reset() {
                    // this.checkAll=false,
                    // this.res.splice(0, this.res.length)
                    this.res = []
                },
                alter() {
                    this.res.forEach(item => {
                        item.checked = !item.checked
                    })
                }
            },
            computed: {

                total() {
                    return this.res.reduce((prev, next) => {
                        return prev + (next.checked ? next.num * next.price : 0)
                    }, 0)
                },

            },
            watch: {
                res: {
                    handler() {
                        if (this.res.length !== 0) {
                            this.checkAll = this.res.some(a => a.checked)
                        }
                    },
                    deep: true,
                    immediate: true
                }
            }
        })


    </script>
</body>

</html>